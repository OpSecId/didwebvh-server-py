{% for did in results %}
<div class="modal modal-blur fade" id="modal-did-{{ loop.index }}" tabindex="-1" aria-hidden="true"
    style="display: none;">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="ti ti-at me-2"></i>DID Details
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="height: 600px; overflow-y: auto;">
                <div class="col-md-12 mb-4">
                    <div class="card card-sm">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-auto">
                                    <span class="avatar avatar-xl"
                                        style="background-image: url({{ did.avatar }})"></span>
                                </div>
                                <div class="col">
                                    <div class="d-flex align-items-center mb-2">
                                        <h3 class="card-title mb-0 me-3">{{ did.scid }}</h3>
                                        {% if did.deactivated == "True" %}
                                        <span class="badge bg-red-lt">
                                            <i class="ti ti-circle-x me-1"></i>Deactivated
                                        </span>
                                        {% else %}
                                        <span class="badge bg-green-lt">
                                            <i class="ti ti-circle-check me-1"></i>Active
                                        </span>
                                        {% endif %}
                                    </div>
                                    <div class="text-muted">
                                        <div class="d-flex align-items-center">
                                            <i class="ti ti-world me-1"></i>
                                            <span class="fw-bold">{{ did.domain }}</span>
                                            <span class="text-muted mx-1">:</span>
                                            <span class="fw-bold">{{ did.namespace }}</span>
                                            <span class="text-muted mx-1">:</span>
                                            <span class="fw-bold">{{ did.identifier }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <div class="btn-list">
                                        <button type="button" class="btn btn-outline-success btn-sm"
                                            onclick="copyToClipboard('{{ did.did }}')" title="Copy DID">
                                            <i class="ti ti-copy me-1"></i>Copy DID
                                        </button>
                                        <a target="_blank" href="{{ did.links.resolver }}"
                                            class="btn btn-outline-secondary btn-sm">
                                            <i class="ti ti-external-link me-1"></i>Resolve
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs nav-bordered card-header-tabs" data-bs-toggle="tabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <a href="#tabs-whois-{{ did.scid }}" class="nav-link active" data-bs-toggle="tab"
                                        aria-selected="true" role="tab">
                                        <i class="ti ti-user-search me-1"></i>Whois
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a href="#tabs-verification-methods-{{ did.scid }}" class="nav-link"
                                        data-bs-toggle="tab" aria-selected="false" role="tab" tabindex="-1">
                                        <i class="ti ti-key me-1"></i>Verification Methods
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a href="#tabs-services-{{ did.scid }}" class="nav-link" data-bs-toggle="tab"
                                        aria-selected="false" role="tab" tabindex="-1">
                                        <i class="ti ti-plug me-1"></i>Services
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a href="#tabs-trust-network-{{ did.scid }}" class="nav-link" data-bs-toggle="tab"
                                        aria-selected="false" role="tab" tabindex="-1">
                                        <i class="ti ti-network me-1"></i>Trust Network
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a href="#tabs-history-{{ did.scid }}" class="nav-link" data-bs-toggle="tab"
                                        aria-selected="false" role="tab" tabindex="-1">
                                        <i class="ti ti-history me-1"></i>History
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a href="#tabs-publications-{{ did.scid }}" class="nav-link" data-bs-toggle="tab"
                                        aria-selected="false" role="tab" tabindex="-1">
                                        <i class="ti ti-file-certificate me-1"></i>Publications
                                    </a>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <a href="#tabs-links-{{ did.scid }}" class="nav-link" data-bs-toggle="tab"
                                        aria-selected="false" role="tab" tabindex="-1">
                                        <i class="ti ti-link me-1"></i>Quick Links
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content">
                                <div class="tab-pane active show" id="tabs-whois-{{ did.scid }}" role="tabpanel">
                                    <div class="row">
                                        {% if did.whois_presentation and did.whois_presentation.verifiableCredential %}
                                        {% for credential in did.whois_presentation.verifiableCredential %}
                                        {% set issuer = credential.issuer %}
                                        {% set issuer_id = issuer.id if issuer is mapping and issuer.id else
                                        (issuer.split(':')[-1] if ':' in (issuer if issuer is string else str(issuer))
                                        else issuer) %}
                                        {% set cred_types = credential.type if credential.type is iterable and
                                        credential.type is not string else [credential.type] %}
                                        {% set display_type = cred_types | reject('equalto', 'VerifiableCredential') |
                                        list %}
                                        {% set final_type = display_type[0] if display_type else cred_types[0] %}
                                        <div class="col-md-12 mb-2">
                                            <div class="card card-sm">
                                                <div class="card-body py-2">
                                                    <div class="d-flex align-items-start">
                                                        <div class="avatar avatar-sm me-3"
                                                            style="background-image: url('data:image/svg+xml;base64,{{ generate_avatar(issuer_id) }}')">
                                                        </div>
                                                        <div class="flex-fill">
                                                            {% set formatted_type = final_type |
                                                            regex_replace('([A-Z])', ' \\1') | trim %}
                                                            <div class="d-flex align-items-center mb-1">
                                                                <h4 class="mb-0 me-2">{{ formatted_type }}</h4>
                                                                <span class="badge bg-blue-lt badge-sm">
                                                                    <i class="ti ti-shield-check"></i>
                                                                </span>
                                                            </div>
                                                            <div class="text-muted small mb-2">
                                                                {% set issuer_did = issuer.id if issuer is mapping and
                                                                issuer.id else issuer %}
                                                                {% set issuer_name = issuer.name if issuer is mapping
                                                                and issuer.name else issuer_did.split(':')[-1] %}
                                                                by <a
                                                                    href="https://dev.uniresolver.io/#{{ issuer_did }}"
                                                                    target="_blank"
                                                                    class="text-decoration-none fw-bold">
                                                                    {{ issuer_name }}
                                                                </a>
                                                                {% if credential.issuanceDate %}
                                                                <span class="text-muted mx-2">•</span>
                                                                <i class="ti ti-clock"></i> {{
                                                                credential.issuanceDate[:10] }}
                                                                {% endif %}
                                                            </div>
                                                            {% if credential.credentialSubject and
                                                            (credential.credentialSubject.name or
                                                            credential.credentialSubject.registeredId) %}
                                                            <div class="text-muted small">
                                                                {% if credential.credentialSubject.name %}
                                                                <i class="ti ti-user me-1"></i><strong>{{
                                                                    credential.credentialSubject.name }}</strong>
                                                                {% if credential.credentialSubject.id %}
                                                                {% if credential.credentialSubject.id ==
                                                                did.whois_presentation.holder %}
                                                                <i class="ti ti-circle-check text-success ms-1"
                                                                    title="Credential subject matches presentation holder"></i>
                                                                {% else %}
                                                                <i class="ti ti-alert-triangle text-warning ms-1"
                                                                    title="Credential subject does not match presentation holder"></i>
                                                                {% endif %}
                                                                {% endif %}
                                                                {% if credential.credentialSubject.registeredId %}
                                                                <span class="mx-1">·</span>
                                                                {% endif %}
                                                                {% endif %}
                                                                {% if credential.credentialSubject.registeredId %}
                                                                <i class="ti ti-id-badge"></i> {{
                                                                credential.credentialSubject.registeredId }}
                                                                {% endif %}
                                                                {% if credential.credentialSubject and
                                                                credential.credentialSubject.idScheme and
                                                                credential.credentialSubject.idScheme.name %}
                                                                <span class="mx-1">·</span>
                                                                {% if credential.credentialSubject.idScheme.id and
                                                                (credential.credentialSubject.idScheme.id.startswith('http://')
                                                                or
                                                                credential.credentialSubject.idScheme.id.startswith('https://'))
                                                                %}
                                                                <a href="{{ credential.credentialSubject.idScheme.id }}"
                                                                    target="_blank" class="text-decoration-none">
                                                                    {{ credential.credentialSubject.idScheme.name }} <i
                                                                        class="ti ti-external-link"></i>
                                                                </a>
                                                                {% else %}
                                                                {{ credential.credentialSubject.idScheme.name }}
                                                                {% endif %}
                                                                {% endif %}
                                                            </div>
                                                            {% endif %}
                                                            {% if credential.credentialSubject %}
                                                            <div class="mt-2">
                                                                <div class="d-flex flex-wrap gap-2">
                                                                    {% for key, value in
                                                                    credential.credentialSubject.items() %}
                                                                    {% if key != 'id' and key != 'type' and key !=
                                                                    'idScheme' and key != 'website' %}
                                                                    {% if value is mapping and value.name %}
                                                                    <span class="badge bg-secondary-lt">
                                                                        {% if value.id and
                                                                        (value.id.startswith('http://') or
                                                                        value.id.startswith('https://')) %}
                                                                        <a href="{{ value.id }}" target="_blank"
                                                                            class="text-decoration-none text-dark">
                                                                            {{ value.name }} <i
                                                                                class="ti ti-external-link"></i>
                                                                        </a>
                                                                        {% elif value.id and value.id.startswith('did:')
                                                                        %}
                                                                        <a href="https://dev.uniresolver.io/#{{ value.id }}"
                                                                            target="_blank"
                                                                            class="text-decoration-none text-dark">
                                                                            {{ value.name }} <i class="ti ti-world"></i>
                                                                        </a>
                                                                        {% else %}
                                                                        {{ value.name }}
                                                                        {% endif %}
                                                                    </span>
                                                                    {% elif value is string and
                                                                    (value.startswith('http://') or
                                                                    value.startswith('https://')) %}
                                                                    <a href="{{ value }}" target="_blank"
                                                                        class="badge bg-secondary-lt text-dark text-decoration-none">
                                                                        {{ key | replace('_', ' ') | title }} <i
                                                                            class="ti ti-external-link"></i>
                                                                    </a>
                                                                    {% elif value is not mapping and value is not
                                                                    iterable %}
                                                                    <span class="text-muted small">{{ key | replace('_',
                                                                        ' ') | title }}: <strong>{{ value
                                                                            }}</strong></span>
                                                                    {% endif %}
                                                                    {% endif %}
                                                                    {% endfor %}
                                                                </div>
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                        {% else %}
                                        <div class="col-md-12">
                                            <div class="empty">
                                                <div class="empty-icon">
                                                    <i class="ti ti-user-search icon icon-lg"></i>
                                                </div>
                                                <p class="empty-title">No whois information</p>
                                                <p class="empty-subtitle text-secondary">
                                                    This DID has not published any whois credentials
                                                </p>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="tab-pane" id="tabs-verification-methods-{{ did.scid }}" role="tabpanel">
                                    {% if did.document and did.document.verificationMethod %}
                                    <div class="list-group list-group-flush">
                                        {% for vm in did.document.verificationMethod %}
                                        <div class="list-group-item">
                                            <div class="row align-items-center">
                                                <div class="col-auto">
                                                    <span class="avatar avatar-sm"
                                                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                                        <i class="ti ti-key text-white"></i>
                                                    </span>
                                                </div>
                                                <div class="col">
                                                    <div class="d-flex align-items-center gap-2 mb-1">
                                                        <span class="fw-bold">Method {{ loop.index }}</span>
                                                        {% if vm.type %}
                                                        <span class="badge bg-blue-lt" style="font-size: 0.7rem;">{{
                                                            vm.type }}</span>
                                                        {% endif %}
                                                    </div>
                                                    <div class="text-muted small font-monospace text-truncate"
                                                        style="max-width: 300px;">
                                                        {{ vm.id.split('#')[-1] if '#' in vm.id else vm.id }}
                                                    </div>
                                                </div>
                                                <div class="col-auto">
                                                    <a href="#" class="btn btn-sm btn-ghost-secondary"
                                                        onclick="event.preventDefault(); toggleVMDetails(this);">
                                                        <i class="ti ti-chevron-down"></i>
                                                    </a>
                                                </div>
                                            </div>
                                            <div class="vm-details mt-3" style="display: none;">
                                                <div class="card card-sm bg-light mb-0">
                                                    <div class="card-body p-3">
                                                        <div class="row g-3">
                                                            <div class="col-12">
                                                                <div class="text-muted"
                                                                    style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">
                                                                    ID</div>
                                                                <code class="small text-wrap d-block"
                                                                    style="word-break: break-all; font-size: 0.75rem;">{{ vm.id }}</code>
                                                            </div>
                                                            {% if vm.controller %}
                                                            <div class="col-12">
                                                                <div class="text-muted"
                                                                    style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">
                                                                    Controller</div>
                                                                <code class="small"
                                                                    style="font-size: 0.75rem;">{{ vm.controller }}</code>
                                                            </div>
                                                            {% endif %}
                                                            {% if vm.publicKeyMultibase %}
                                                            <div class="col-12">
                                                                <div class="text-muted mb-1"
                                                                    style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">
                                                                    <i class="ti ti-fingerprint me-1"></i>Public Key
                                                                    (Multibase)
                                                                </div>
                                                                <div class="bg-white p-2 rounded border">
                                                                    <code class="small text-wrap d-block"
                                                                        style="word-break: break-all; font-size: 0.7rem;">{{ vm.publicKeyMultibase }}</code>
                                                                </div>
                                                            </div>
                                                            {% endif %}
                                                            {% if vm.publicKeyJwk %}
                                                            <div class="col-12">
                                                                <div class="text-muted mb-1"
                                                                    style="font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">
                                                                    <i class="ti ti-braces me-1"></i>Public Key (JWK)
                                                                </div>
                                                                <div class="bg-white p-2 rounded border">
                                                                    <pre
                                                                        class="mb-0"><code style="font-size: 0.7rem;">{{ vm.publicKeyJwk | tojson(indent=2) }}</code></pre>
                                                                </div>
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    <script>
                                        function toggleVMDetails(btn) {
                                            const listItem = btn.closest('.list-group-item');
                                            const details = listItem.querySelector('.vm-details');
                                            const icon = btn.querySelector('i');

                                            if (details.style.display === 'none') {
                                                details.style.display = 'block';
                                                icon.classList.remove('ti-chevron-down');
                                                icon.classList.add('ti-chevron-up');
                                            } else {
                                                details.style.display = 'none';
                                                icon.classList.remove('ti-chevron-up');
                                                icon.classList.add('ti-chevron-down');
                                            }
                                        }
                                    </script>
                                    {% else %}
                                    <div class="empty">
                                        <div class="empty-icon">
                                            <i class="ti ti-key icon icon-lg"></i>
                                        </div>
                                        <p class="empty-title">No verification methods</p>
                                        <p class="empty-subtitle text-secondary">
                                            This DID document has no verification methods
                                        </p>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="tab-pane" id="tabs-services-{{ did.scid }}" role="tabpanel">
                                    <div class="row">
                                        {% if did.document and did.document.service %}
                                        {% for service in did.document.service %}
                                        <div class="col-md-12 mb-3">
                                            <div class="card card-link-pop">
                                                <div class="card-body">
                                                    <div class="d-flex align-items-start">
                                                        <div class="avatar avatar-rounded me-3"
                                                            style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                                            <i class="ti ti-plug fs-2 text-white"></i>
                                                        </div>
                                                        <div class="flex-fill">
                                                            <h3 class="card-title mb-3">
                                                                {{ service.type if service.type else 'Service' }}
                                                                {% if 'LinkedDomains' in service.type %}
                                                                <span class="badge bg-purple-lt ms-2">Linked
                                                                    Domains</span>
                                                                {% elif 'DIDCommMessaging' in service.type %}
                                                                <span class="badge bg-cyan-lt ms-2">DIDComm</span>
                                                                {% elif 'CredentialRegistry' in service.type %}
                                                                <span class="badge bg-green-lt ms-2">Credentials</span>
                                                                {% endif %}
                                                            </h3>
                                                            <div class="mb-3">
                                                                <div class="text-muted small mb-1">Service ID</div>
                                                                <code class="small text-wrap d-block"
                                                                    style="word-break: break-all;">{{ service.id }}</code>
                                                            </div>
                                                            {% if service.serviceEndpoint %}
                                                            <div class="mb-3">
                                                                <div class="text-muted small mb-1">
                                                                    <i class="ti ti-link me-1"></i>Service Endpoint
                                                                </div>
                                                                {% if service.serviceEndpoint is string %}
                                                                <a href="{{ service.serviceEndpoint }}" target="_blank"
                                                                    class="text-decoration-none">
                                                                    <code
                                                                        class="small">{{ service.serviceEndpoint }}</code>
                                                                    <i class="ti ti-external-link ms-1"></i>
                                                                </a>
                                                                {% else %}
                                                                <pre
                                                                    class="bg-light p-3 rounded"><code>{{ service.serviceEndpoint | tojson(indent=2) }}</code></pre>
                                                                {% endif %}
                                                            </div>
                                                            {% endif %}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        {% endfor %}
                                        {% else %}
                                        <div class="col-md-12">
                                            <div class="empty">
                                                <div class="empty-icon">
                                                    <i class="ti ti-plug icon icon-lg"></i>
                                                </div>
                                                <p class="empty-title">No services configured</p>
                                                <p class="empty-subtitle text-secondary">
                                                    This DID document has no service endpoints
                                                </p>
                                                <div class="empty-action">
                                                    <p class="text-muted small">
                                                        Services can be used for:<br>
                                                        • DIDComm messaging endpoints<br>
                                                        • Linked domain verification<br>
                                                        • Credential registries<br>
                                                        • Other DID-related services
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="tab-pane" id="tabs-trust-network-{{ did.scid }}" role="tabpanel">
                                    {% set has_witnesses = (did.parameters and did.parameters.witness) or (did.witnesses
                                    and did.witnesses|length > 0) %}
                                    {% set has_watchers = (did.parameters and did.parameters.watchers) or did.watchers
                                    %}

                                    {% if has_witnesses or has_watchers %}
                                    <div class="row g-3">
                                        {# Witnesses Section #}
                                        {% if has_witnesses %}
                                        <div class="col-md-6">
                                            <h5 class="mb-3"
                                                style="font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; color: #667;">
                                                <i class="ti ti-eye-check me-2"></i>Witnesses
                                                {% if did.parameters and did.parameters.witness %}
                                                <span class="badge bg-pink-lt ms-2" style="font-size: 0.65rem;">{{
                                                    did.parameters.witness.threshold }}/{{
                                                    did.parameters.witness.witnesses|length }}</span>
                                                {% endif %}
                                            </h5>
                                            <div class="row g-2">
                                                {% if did.parameters and did.parameters.witness %}
                                                {% for witness in did.parameters.witness.witnesses %}
                                                <div class="col-12">
                                                    <div class="card card-sm mb-0">
                                                        <div class="card-body py-2 px-3">
                                                            <div class="d-flex align-items-center">
                                                                <div class="avatar avatar-xs me-2"
                                                                    style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                                                    <i class="ti ti-eye-check text-white"
                                                                        style="font-size: 0.9rem;"></i>
                                                                </div>
                                                                <div class="flex-fill" style="min-width: 0;">
                                                                    <code class="small text-wrap"
                                                                        style="word-break: break-all; font-size: 0.7rem;">{{ witness.id }}</code>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                                {% elif did.witnesses %}
                                                {% for witness in did.witnesses %}
                                                <div class="col-12">
                                                    <div class="card card-sm mb-0">
                                                        <div class="card-body py-2 px-3">
                                                            <div class="d-flex align-items-center">
                                                                <div class="avatar avatar-xs me-2"
                                                                    style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                                                    <i class="ti ti-eye-check text-white"
                                                                        style="font-size: 0.9rem;"></i>
                                                                </div>
                                                                <div class="flex-fill" style="min-width: 0;">
                                                                    <code class="small text-wrap"
                                                                        style="word-break: break-all; font-size: 0.7rem;">{{ witness.id if witness.id is defined else witness }}</code>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                                {% endif %}
                                            </div>
                                        </div>
                                        {% endif %}

                                        {# Watchers Section #}
                                        {% if has_watchers %}
                                        <div class="col-md-6">
                                            <h5 class="mb-3"
                                                style="font-size: 0.875rem; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; color: #667;">
                                                <i class="ti ti-eye me-2"></i>Watchers
                                            </h5>
                                            <div class="row g-2">
                                                {% set watcher_list = did.parameters.watchers if (did.parameters and
                                                did.parameters.watchers) else (did.watchers if did.watchers else []) %}
                                                {% for watcher in watcher_list %}
                                                <div class="col-12">
                                                    <div class="card card-sm mb-0">
                                                        <div class="card-body py-2 px-3">
                                                            <div class="d-flex align-items-center">
                                                                <div class="avatar avatar-xs me-2"
                                                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                                                    <i class="ti ti-eye text-white"
                                                                        style="font-size: 0.9rem;"></i>
                                                                </div>
                                                                <div class="flex-fill" style="min-width: 0;">
                                                                    <a href="{{ watcher }}" target="_blank"
                                                                        class="text-decoration-none fw-bold small">
                                                                        {{ watcher }}
                                                                    </a>
                                                                </div>
                                                                <div class="btn-list">
                                                                    <a href="{{ watcher }}/log?scid={{ did.scid }}"
                                                                        target="_blank"
                                                                        class="btn btn-sm btn-icon btn-ghost-secondary"
                                                                        title="View Log">
                                                                        <i class="ti ti-file-text"
                                                                            style="font-size: 0.9rem;"></i>
                                                                    </a>
                                                                    <a href="{{ watcher }}/witness?scid={{ did.scid }}"
                                                                        target="_blank"
                                                                        class="btn btn-sm btn-icon btn-ghost-secondary"
                                                                        title="View Witness">
                                                                        <i class="ti ti-certificate"
                                                                            style="font-size: 0.9rem;"></i>
                                                                    </a>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% else %}
                                    <div class="empty">
                                        <div class="empty-icon">
                                            <i class="ti ti-network icon icon-lg"></i>
                                        </div>
                                        <p class="empty-title">No trust network configured</p>
                                        <p class="empty-subtitle text-secondary">
                                            This DID has no witnesses or watchers
                                        </p>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="tab-pane" id="tabs-history-{{ did.scid }}" role="tabpanel">
                                    <div class="row">
                                        {% if did.logs %}
                                        <div class="col-md-12">
                                            <div class="list-group list-group-flush">
                                                {% for log in did.logs %}
                                                <div class="list-group-item">
                                                    <div class="d-flex align-items-center">
                                                        <span class="avatar avatar-sm me-3 bg-primary-lt">
                                                            <i class="ti ti-git-commit"></i>
                                                        </span>
                                                        <div class="flex-fill">
                                                            <div class="fw-bold">Version {{ log.versionId }}</div>
                                                            <div class="text-secondary" style="font-size: 0.75rem;">
                                                                <i class="ti ti-clock me-1"></i>{{ log.versionTime }}
                                                            </div>
                                                        </div>
                                                        <span class="badge badge-sm bg-blue-lt">v{{ loop.index }}</span>
                                                    </div>
                                                </div>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        {% else %}
                                        <div class="col-md-12">
                                            <div class="empty">
                                                <div class="empty-icon">
                                                    <i class="ti ti-history icon icon-lg"></i>
                                                </div>
                                                <p class="empty-title">No history available</p>
                                                <p class="empty-subtitle text-secondary">
                                                    No log entries found for this DID
                                                </p>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="tab-pane" id="tabs-publications-{{ did.scid }}" role="tabpanel">
                                    <div class="row">
                                        <!-- Verifiable Credentials Section -->
                                        <div class="col-md-12 mb-3">
                                            <h5 class="mb-2 text-muted text-uppercase"
                                                style="font-size: 0.75rem; font-weight: 600; letter-spacing: 0.5px;">
                                                <i class="ti ti-certificate me-1"></i>Verifiable Credentials
                                            </h5>
                                            {% if did.credentials %}
                                            <div class="list-group list-group-flush">
                                                {% for credential in did.credentials %}
                                                <a href="/explorer/credentials?credential_id={{ credential.id }}"
                                                    class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        <span class="avatar avatar-sm me-3 bg-primary-lt">
                                                            <i class="ti ti-certificate"></i>
                                                        </span>
                                                        <div class="flex-fill">
                                                            {% set cred_types = credential.type if credential.type is
                                                            iterable and credential.type is not string else
                                                            [credential.type] %}
                                                            {% set display_type = cred_types | reject('equalto',
                                                            'VerifiableCredential') | list %}
                                                            {% set final_type = display_type[0] if display_type else
                                                            cred_types[0] %}
                                                            <div class="fw-bold">{{ final_type |
                                                                regex_replace('([A-Z])', ' \\1') | trim }}</div>
                                                            <div class="text-muted small">
                                                                {% if credential.issued %}
                                                                <i class="ti ti-calendar me-1"></i>{{ credential.issued
                                                                }}
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                        <div class="text-end">
                                                            <i class="ti ti-chevron-right text-muted"></i>
                                                        </div>
                                                    </div>
                                                </a>
                                                {% endfor %}
                                            </div>
                                            {% else %}
                                            <div class="text-muted small">
                                                <i class="ti ti-info-circle me-1"></i>No verifiable credentials issued
                                                by this DID
                                            </div>
                                            {% endif %}
                                        </div>

                                        <!-- Attested Resources Section -->
                                        <div class="col-md-12">
                                            <h5 class="mb-2 text-muted text-uppercase"
                                                style="font-size: 0.75rem; font-weight: 600; letter-spacing: 0.5px;">
                                                <i class="ti ti-files me-1"></i>Attested Resources
                                            </h5>
                                            {% if did.resources %}
                                            <div class="list-group list-group-flush">
                                                {% for resource in did.resources %}
                                                <a href="resources?resource_id={{ resource.digest }}"
                                                    class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        {% if 'Schema' in resource.type %}
                                                        <span class="avatar avatar-sm me-3 bg-blue-lt">
                                                            <i class="ti ti-database"></i>
                                                        </span>
                                                        {% elif 'CredDef' in resource.type %}
                                                        <span class="avatar avatar-sm me-3 bg-indigo-lt">
                                                            <i class="ti ti-id-badge"></i>
                                                        </span>
                                                        {% elif 'RevReg' in resource.type %}
                                                        <span class="avatar avatar-sm me-3 bg-pink-lt">
                                                            <i class="ti ti-refresh"></i>
                                                        </span>
                                                        {% else %}
                                                        <span class="avatar avatar-sm me-3 bg-secondary-lt">
                                                            <i class="ti ti-file"></i>
                                                        </span>
                                                        {% endif %}
                                                        <div class="flex-fill">
                                                            <div class="fw-bold">{{ resource.type }}</div>
                                                            <div class="text-secondary text-truncate"
                                                                style="font-size: 0.75rem; max-width: 400px;">
                                                                {{ resource.details }}
                                                            </div>
                                                        </div>
                                                        <i class="ti ti-chevron-right text-muted"></i>
                                                    </div>
                                                </a>
                                                {% endfor %}
                                            </div>
                                        </div>
                                        {% else %}
                                        <div class="text-muted small">
                                            <i class="ti ti-info-circle me-1"></i>No attested resources published by
                                            this DID
                                        </div>
                                        {% endif %}
                                    </div>

                                    <!-- Empty State (if no publications at all) -->
                                    {% if not did.credentials and not did.resources %}
                                    <div class="col-md-12">
                                        <div class="empty">
                                            <div class="empty-icon">
                                                <i class="ti ti-file-certificate icon icon-lg"></i>
                                            </div>
                                            <p class="empty-title">No publications found</p>
                                            <p class="empty-subtitle text-secondary">
                                                This DID has not published any credentials or resources
                                            </p>
                                            <div class="empty-action">
                                                <a href="resources?scid={{ did.scid }}" class="btn btn-primary">
                                                    <i class="ti ti-clipboard-search me-1"></i>Browse All Resources
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="tab-pane" id="tabs-links-{{ did.scid }}" role="tabpanel">
                                    <div class="row">
                                        <div class="col-md-12 mb-3">
                                            <h4 class="mb-3">
                                                <i class="ti ti-link me-2"></i>Quick Links
                                            </h4>
                                            <div class="list-group list-group-flush">
                                                <a href="credentials?scid={{ did.scid }}"
                                                    class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        <span class="avatar avatar-sm me-3 bg-purple-lt">
                                                            <i class="ti ti-certificate"></i>
                                                        </span>
                                                        <div class="flex-fill">
                                                            <div class="fw-bold">Browse Credentials</div>
                                                            {% if did.credentials %}
                                                            <div class="text-muted small">{{ did.credentials|length }}
                                                                credential(s)</div>
                                                            {% endif %}
                                                        </div>
                                                        <span class="badge badge-sm">Internal</span>
                                                    </div>
                                                </a>
                                                <a href="resources?scid={{ did.scid }}"
                                                    class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        <span class="avatar avatar-sm me-3 bg-primary-lt">
                                                            <i class="ti ti-clipboard-search"></i>
                                                        </span>
                                                        <div class="flex-fill">
                                                            <div class="fw-bold">Browse Resources</div>
                                                            {% if did.resources %}
                                                            <div class="text-muted small">{{ did.resources|length }}
                                                                resource(s)</div>
                                                            {% endif %}
                                                        </div>
                                                        <span class="badge badge-sm">Internal</span>
                                                    </div>
                                                </a>
                                                <a target="_blank" href="{{ did.links.resolver }}"
                                                    class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        <span class="avatar avatar-sm me-3 bg-blue-lt">
                                                            <i class="ti ti-external-link"></i>
                                                        </span>
                                                        <div class="flex-fill">
                                                            <div class="fw-bold">Resolve DID</div>
                                                        </div>
                                                        <span class="badge badge-sm bg-blue-lt">External</span>
                                                    </div>
                                                </a>
                                                <a target="_blank" href="{{ did.links.log_file }}"
                                                    class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        <span class="avatar avatar-sm me-3 bg-green-lt">
                                                            <i class="ti ti-file-text"></i>
                                                        </span>
                                                        <div class="flex-fill">
                                                            <div class="fw-bold">Log File</div>
                                                        </div>
                                                        <span class="badge badge-sm bg-green-lt">External</span>
                                                    </div>
                                                </a>
                                                <a target="_blank" href="{{ did.links.witness_file }}"
                                                    class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        <span class="avatar avatar-sm me-3 bg-orange-lt">
                                                            <i class="ti ti-certificate"></i>
                                                        </span>
                                                        <div class="flex-fill">
                                                            <div class="fw-bold">Witness File</div>
                                                        </div>
                                                        <span class="badge badge-sm bg-orange-lt">External</span>
                                                    </div>
                                                </a>
                                                <a target="_blank" href="{{ did.links.whois_presentation }}"
                                                    class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        <span class="avatar avatar-sm me-3"
                                                            style="background-color: var(--brand-accent-light); color: var(--brand-accent);">
                                                            <i class="ti ti-id-badge-2"></i>
                                                        </span>
                                                        <div class="flex-fill">
                                                            <div class="fw-bold">WHOIS Presentation</div>
                                                        </div>
                                                        <span class="badge badge-sm"
                                                            style="background-color: var(--brand-accent-light); color: var(--brand-accent);">External</span>
                                                    </div>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn me-auto" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endfor %}